[{"id":"2567a318.c428a4","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"7157d0ac.afd278","type":"serial-port","z":"","serialport":"/dev/tty.SLAB_USBtoUART","serialbaud":"57600","databits":"8","parity":"none","stopbits":"1","waitfor":"","dtr":"none","rts":"none","cts":"high","dsr":"none","newline":";","bin":"false","out":"char","addchar":"","responsetimeout":"50"},{"id":"11a4a0d0.2b8ecf","type":"switch","z":"2567a318.c428a4","name":"decode msg","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"^FA","vt":"str","case":false},{"t":"regex","v":"^MD","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":910,"y":500,"wires":[["adca7931.872728"],["e411960a.2363e"],[]]},{"id":"218ac2b5.977126","type":"function","z":"2567a318.c428a4","name":"synched frequency","func":"flow.set('freq', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":220,"wires":[["99a723d1.4adef"]]},{"id":"71b0ab3f.2ce86c","type":"serial in","z":"2567a318.c428a4","name":"TS590 serial in","serial":"7157d0ac.afd278","x":240,"y":500,"wires":[["15fc324b.d35cf6","2730202d.f4eeb8"]]},{"id":"2730202d.f4eeb8","type":"split","z":"2567a318.c428a4","name":"split by \";\"","splt":";","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":450,"y":500,"wires":[["802aac27.d799e"]]},{"id":"15fc324b.d35cf6","type":"debug","z":"2567a318.c428a4","name":"TS590 serial in","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":310,"y":560,"wires":[]},{"id":"802aac27.d799e","type":"switch","z":"2567a318.c428a4","name":"delete empty and \"?\" messages","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"\\?","vt":"str","case":false},{"t":"empty"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":680,"y":500,"wires":[[],[],["11a4a0d0.2b8ecf","a8129d03.778888"]]},{"id":"5ee97017.e1fad8","type":"debug","z":"2567a318.c428a4","name":"synched freq","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":770,"y":280,"wires":[]},{"id":"7a3506e2.d9f358","type":"rbe","z":"2567a318.c428a4","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1290,"y":480,"wires":[["54bc4149.107d4","bba28a01.d07"]]},{"id":"adca7931.872728","type":"function","z":"2567a318.c428a4","name":"TS590 frequency","func":"f = parseInt(msg.payload.slice(2));\nmsg.payload = f;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":480,"wires":[["7a3506e2.d9f358"]]},{"id":"54bc4149.107d4","type":"link out","z":"2567a318.c428a4","name":"","links":["6c640c27.c92afc"],"x":1395,"y":480,"wires":[]},{"id":"e411960a.2363e","type":"function","z":"2567a318.c428a4","name":"TS590 mode","func":"f = parseInt(msg.payload.slice(2));\nflow.set('mode', f);\nmsg.payload = f;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":520,"wires":[[]]},{"id":"6c640c27.c92afc","type":"link in","z":"2567a318.c428a4","name":"","links":["54bc4149.107d4","ae5baa1e.1a4b28"],"x":255,"y":220,"wires":[["218ac2b5.977126"]]},{"id":"a04f7c82.2c3d1","type":"link out","z":"2567a318.c428a4","name":"","links":["763d8174.9f848","b8913ddd.bcf758"],"x":715,"y":220,"wires":[]},{"id":"e8c2a6bc.ddcc4","type":"comment","z":"2567a318.c428a4","name":"send changes to gqrx","info":"","x":260,"y":1220,"wires":[]},{"id":"3a8bdc2c.156d54","type":"function","z":"2567a318.c428a4","name":"set GQRX frequency","func":"msg.payload = \"F \" + msg.payload;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1300,"wires":[["165b4014.c162d8","a778ff4f.095bb8"]]},{"id":"75ce5018.3f0258","type":"function","z":"2567a318.c428a4","d":true,"name":"set GQRX mode","func":"switch(parseInt(msg.payload)) {\n  case 1:\n    msg.payload = \"LSB\";\n    break;\n  case 2:\n    msg.payload = \"USB\";\n    break;\n  case 3:\n    msg.payload = \"CW\";\n    break;\n  case 4:\n    msg.payload = \"FM\";\n    break;\n  case 5:\n    msg.payload = \"AM\";\n    break;\n  case 6:\n    msg.payload = \"USB\";\n    break;\n  default:\n    return;\n    // code block\n} \n\nmsg.payload = \"M \" + msg.payload + \"\\r\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1340,"wires":[[]]},{"id":"3f588e86.a9841a","type":"tcp request","z":"2567a318.c428a4","server":"127.0.0.1","port":"7356","out":"char","splitc":"\\n","name":"GQRX set request","x":1090,"y":1480,"wires":[["681dec55.0ec2f4"]]},{"id":"56a90595.8e6484","type":"inject","z":"2567a318.c428a4","name":"poll gqrx \"f \"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"0.2","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"f","payloadType":"str","x":420,"y":1480,"wires":[["165b4014.c162d8"]]},{"id":"a778ff4f.095bb8","type":"debug","z":"2567a318.c428a4","name":"gqrx request","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":1300,"wires":[]},{"id":"681dec55.0ec2f4","type":"switch","z":"2567a318.c428a4","name":"decode reponse","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"^RPRT 0","vt":"str","case":false},{"t":"regex","v":"^RPRT 1","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1300,"y":1480,"wires":[[],["699dc26b.9e6a84"],["2205bff5.027f18"]]},{"id":"699dc26b.9e6a84","type":"debug","z":"2567a318.c428a4","name":"gqrx error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1500,"y":1440,"wires":[]},{"id":"165b4014.c162d8","type":"function","z":"2567a318.c428a4","name":"pass and add NL","func":"msg.payload = msg.payload +\"\\n\"\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":1480,"wires":[["f14ca7da.13bb18"]]},{"id":"763d8174.9f848","type":"link in","z":"2567a318.c428a4","name":"frequency","links":["56f23373.eea424","a04f7c82.2c3d1"],"x":255,"y":1300,"wires":[["3a8bdc2c.156d54"]]},{"id":"8714ab28.c417","type":"comment","z":"2567a318.c428a4","name":"poll gqrx for changes","info":"","x":280,"y":1420,"wires":[]},{"id":"f14ca7da.13bb18","type":"delay","z":"2567a318.c428a4","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"500","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":900,"y":1480,"wires":[["3f588e86.a9841a"]]},{"id":"6ab0c79a.16ed88","type":"rbe","z":"2567a318.c428a4","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1630,"y":1500,"wires":[["ae5baa1e.1a4b28","31c358fd.ece39"]]},{"id":"ae5baa1e.1a4b28","type":"link out","z":"2567a318.c428a4","name":"","links":["6c640c27.c92afc"],"x":1775,"y":1500,"wires":[]},{"id":"31c358fd.ece39","type":"debug","z":"2567a318.c428a4","name":"gqrx freq change","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1830,"y":1580,"wires":[]},{"id":"2205bff5.027f18","type":"function","z":"2567a318.c428a4","name":"gqrx freq","func":"\nf = parseInt(msg.payload);\n\n\nmsg.payload = f;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":1500,"wires":[["6ab0c79a.16ed88"]]},{"id":"99a723d1.4adef","type":"rbe","z":"2567a318.c428a4","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":590,"y":220,"wires":[["a04f7c82.2c3d1","5ee97017.e1fad8"]]},{"id":"bcd3b431.1b416","type":"function","z":"2567a318.c428a4","name":"build ts590 FA cmd","func":"\nf = \"00000000000\" + (msg.payload) +\"0\";\nf = f.substr(-12);\nf = f.slice(0, -1);\n\nmsg.payload = \"FA\" + f + \";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":720,"wires":[["ae71736d.90f3a8"]]},{"id":"b1a26db2.974628","type":"debug","z":"2567a318.c428a4","name":"ts590 cmd","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":890,"y":760,"wires":[]},{"id":"20afbe05.00aec2","type":"serial out","z":"2567a318.c428a4","name":"TS590 serial out","serial":"7157d0ac.afd278","x":900,"y":700,"wires":[]},{"id":"b8913ddd.bcf758","type":"link in","z":"2567a318.c428a4","name":"","links":["a04f7c82.2c3d1"],"x":255,"y":720,"wires":[["bcd3b431.1b416"]]},{"id":"18be1e2c.8b3daa","type":"inject","z":"2567a318.c428a4","name":"reset TS590 comms","props":[{"p":"payload"}],"repeat":"5","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"IF;AI4;","payloadType":"str","x":480,"y":660,"wires":[["ae71736d.90f3a8"]]},{"id":"bba28a01.d07","type":"debug","z":"2567a318.c428a4","name":"TS590 freq change","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1470,"y":520,"wires":[]},{"id":"ae71736d.90f3a8","type":"function","z":"2567a318.c428a4","name":"pass","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":720,"wires":[["20afbe05.00aec2","b1a26db2.974628"]]},{"id":"26503017.ccbd1","type":"comment","z":"2567a318.c428a4","name":"handle gqrx","info":"","x":110,"y":1160,"wires":[]},{"id":"5c8e7562.58805c","type":"comment","z":"2567a318.c428a4","name":"handle TS590","info":"TS590 is set to AI4; so it reports all changes without polling\n\n","x":130,"y":440,"wires":[]},{"id":"c2429440.f634b","type":"comment","z":"2567a318.c428a4","name":"central frequency for all rigs","info":"","x":160,"y":140,"wires":[]},{"id":"45511962.276a48","type":"debug","z":"2567a318.c428a4","name":"RUMLog TCP out","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":770,"y":1040,"wires":[]},{"id":"b5803ae8.706908","type":"tcp out","z":"2567a318.c428a4","host":"localhost","port":"8888","beserver":"reply","base64":false,"end":false,"name":"RUMLOG TCP out","x":770,"y":980,"wires":[]},{"id":"127b39e7.f993de","type":"tcp in","z":"2567a318.c428a4","name":"RUMLog TCP in","server":"server","host":"","port":"8888","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":200,"y":940,"wires":[["56f725ed.c911c4","fdb05e45.e27b38"]]},{"id":"56f725ed.c911c4","type":"debug","z":"2567a318.c428a4","name":"RUMLog TCP in","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":300,"y":1020,"wires":[]},{"id":"613bc6c3.f9db6","type":"comment","z":"2567a318.c428a4","name":"echo RUMLog <-> TS590","info":"","x":150,"y":880,"wires":[]},{"id":"a8129d03.778888","type":"function","z":"2567a318.c428a4","name":"add \";\"","func":"msg.payload=msg.payload + \";\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":980,"wires":[["b5803ae8.706908","45511962.276a48"]]},{"id":"fdb05e45.e27b38","type":"function","z":"2567a318.c428a4","name":"delete AI0; messages","func":"if (msg.payload==\"AI0;\") {\n    return;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":840,"wires":[["ae71736d.90f3a8"]]}]